name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:

          - python: 3.8
            env: "Django>=1.4,<1.5"
          - python: 3.8
            env: "Django>=1.5,<1.6"
          - python: 3.8
            env: "Django>=1.6,<1.7"
          - python: 3.8
            env: "Django>=1.7,<1.8"
          - python: 3.8
            env: "Django>=1.8,<1.9"
          - python: 3.8
            env: "Django>=1.9,<1.10"
          - python: 3.8
            env: "Django>=1.10,<1.11"
          - python: 3.8
            env: "Django>=1.11,<2.0"
          - python: 3.8
            env: "https://github.com/django/django/archive/master.tar.gz"
          - python: 3.9
            env: "Django>=1.4,<1.5"
          - python: 3.9
            env: "Django>=1.5,<1.6"
          - python: 3.9
            env: "Django>=1.6,<1.7"
          - python: 3.9
            env: "Django>=1.7,<1.8"
          - python: 3.9
            env: "Django>=1.8,<1.9"
          - python: 3.9
            env: "Django>=1.9,<4.0"
          - python: 3.9
            env: "Django>=1.10,<3.0"
          - python: 3.9
            env: "Django>=1.11,<2.0"
          - python: 3.9
            env: "https://github.com/django/django/archive/master.tar.gz"


    steps:
      - uses: actions/checkout@v2

      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python }}

      - name: Install dependencies
        run: |
          pip install coveralls coverage
          pip install '${{ matrix.env }}'

      - name: Run tests
        run: coverage run runtests.py

      - name: Generate coverage report
        run: coverage report -m

      - name: Combine coverage data
        run: coverage combine

      - name: Upload coverage to coveralls
        run: coveralls